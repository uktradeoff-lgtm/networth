<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>True Earnings Calculator (UK)</title>

  <style>
    :root{
      --text:#111;
      --muted:#666;
      --border:#e9e9e9;
      --bg:#fff;
      --soft:#fafafa;
      --hero:#f6f8ff;
      --heroBorder:#dfe6ff;
    }

    /* Mobile-first base */
    html { -webkit-text-size-adjust: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      line-height: 1.45;
      font-size: 16px;
    }

    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 42px;
    }

    h1{
      font-size: 20px;
      margin: 4px 0 6px;
      letter-spacing: -0.2px;
    }

    .sub{
      color: var(--muted);
      font-size: 13px;
      margin: 0 0 16px;
    }

    /* Sections (no outline boxes) */
    .section{
      margin: 22px 0;
      padding-top: 18px;
      border-top: 1px solid var(--border);
    }
    .section:first-of-type{
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }

    .sectionTitle{
      margin: 0 0 10px;
      font-size: 14px;
      font-weight: 700;
      color: #222;
    }

    /* Inputs */
    .grid2{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 10px;
    }

    label{
      display: block;
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 14px;
      color: #222;
    }

    input[type="number"]{
      width: 100%;
      padding: 12px 12px;
      border: 1px solid #d0d0d0;
      border-radius: 12px;
      background: #fff;
      font-size: 16px; /* avoid iOS zoom */
      line-height: 1.2;
      min-height: 44px; /* tap target */
      box-sizing: border-box;
      outline: none;
    }
    input[type="number"]:focus{
      border-color: #b9c6ff;
      box-shadow: 0 0 0 3px rgba(72, 105, 255, 0.15);
    }

    .hint{
      color: #555;
      font-size: 13px;
      margin-top: 6px;
    }

    /* Messages */
    .err{
      background: #ffecec;
      border: 1px solid #ffb3b3;
      padding: 10px 12px;
      border-radius: 12px;
      margin-top: 12px;
      display: none;
      font-size: 14px;
    }
    .warn{
      background: #fff6e5;
      border: 1px solid #ffd08a;
      padding: 10px 12px;
      border-radius: 12px;
      margin-top: 12px;
      display: none;
      font-size: 14px;
    }

    /* Hero */
    .hero{
      background: var(--hero);
      border: 1px solid var(--heroBorder);
      border-radius: 14px;
      padding: 14px 14px;
      margin: 18px 0 8px;
      display: none;
    }
    .hero .big{
      font-size: 22px;
      font-weight: 900;
      margin-top: 4px;
      letter-spacing: -0.2px;
    }

    /* KPI */
    .kpi{
      background: var(--soft);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 12px;
      margin-top: 10px;
    }
    .kpi .name{
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 2px;
    }
    .kpi .val{
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.2px;
    }

    /* Tables */
    .tableWrap{
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-top: 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      min-width: 860px; /* ensure scroll on mobile */
    }
    th, td{
      border-bottom: 1px solid #eee;
      padding: 10px 10px;
      text-align: left;
      vertical-align: top;
      white-space: nowrap;
    }
    th{
      background: #fafafa;
      font-weight: 800;
      color: #222;
    }
    tfoot th{
      background: #fafafa;
    }

    .calcBox{
      margin-top: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fcfcfc;
    }
    .calcEq{
      font-size: 13px;
      color:#333;
      margin: 0;
    }
    .calcNums{
      font-size: 13px;
      color:#555;
      margin-top: 6px;
      word-break: break-word;
    }

    /* Larger screens */
    @media (min-width: 720px){
      .container{ padding: 26px 18px 56px; }
      h1{ font-size: 22px; }
      .grid2{ grid-template-columns: 1fr 1fr; gap: 14px; }
      .hero .big{ font-size: 24px; }
      .kpi .val{ font-size: 24px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>True Earnings Calculator (UK)</h1>
    <div class="sub">
      England, Wales and Northern Ireland rules for 2025/26.
      Includes Income Tax and employee Class 1 National Insurance (category A).
      Assumes employee pension reduces adjusted net income (salary sacrifice / net pay).
      Carry forward and relief-at-source are not modelled. Educational use only.
    </div>

    <!-- Inputs -->
    <div class="section" id="inputsSection">
      <div class="sectionTitle">Inputs</div>

      <div class="grid2">
        <div>
          <label for="grossIncome">Gross income (£/year)</label>
          <input id="grossIncome" type="number" min="0" step="100" placeholder="e.g. 160000" inputmode="numeric" />
          <div class="hint">Annual income before Income Tax and National Insurance.</div>
        </div>

        <div>
          <label for="employeePension">Employee pension (£/year)</label>
          <input id="employeePension" type="number" min="0" step="100" placeholder="e.g. 60000" inputmode="numeric" />
          <div class="hint">Hard cap: tool will not run if employee pension exceeds £60,000 (carry forward ignored).</div>
        </div>
      </div>

      <div class="grid2" style="margin-top:12px;">
        <div>
          <label for="employerPension">Employer pension (£/year, optional)</label>
          <input id="employerPension" type="number" min="0" step="100" placeholder="0" inputmode="numeric" />
          <div class="hint">Included in “Total earned + invested”. Does not reduce Income Tax or employee NI.</div>
        </div>
        <div></div>
      </div>

      <div id="errorBox" class="err"></div>
      <div id="taperNote" class="warn"></div>
    </div>

    <!-- Hero -->
    <div class="hero" id="hero">
      <div class="sectionTitle" style="margin:0;">Difference in total earned + invested (with pension vs without)</div>
      <div class="big" id="heroDelta">£0</div>
      <div class="sub" style="margin:6px 0 0;">
        Total earned + invested = take-home cash after Income Tax + employee NI, plus pension (employee + employer).
      </div>
    </div>

    <!-- Scenario 1 -->
    <div class="section" id="baselineSection" style="display:none;">
      <div class="sectionTitle">Scenario 1: No pension</div>

      <div class="kpi">
        <div class="name">Take-home cash</div>
        <div class="val" id="b_takeHomeKpi">£0</div>
      </div>

      <div style="margin-top:12px;">
        <div class="sectionTitle">Income Tax breakdown</div>
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Band</th>
                <th>Income</th>
                <th>Income tax</th>
                <th>Employee NI</th>
                <th>Take-home</th>
              </tr>
            </thead>
            <tbody id="b_tableBody"></tbody>
            <tfoot>
              <tr>
                <th>Total</th>
                <th id="b_incomeTotal">£0</th>
                <th id="b_taxTotal">£0</th>
                <th id="b_niTotal">£0</th>
                <th id="b_takeHomeTotal">£0</th>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="calcBox">
          <div class="sectionTitle" style="margin:0 0 6px;">Total earned + invested calculation</div>
          <p class="calcEq">Total earned + invested = taxable income − income tax − NI contributions + pension contributions</p>
          <div class="calcNums" id="b_calcNums">£0 = £0 − £0 − £0 + £0</div>
        </div>

        <div class="sub" style="margin-top:10px;">
          NI uses weekly thresholds and is approximated by spreading annual pay evenly across 52 weeks.
        </div>
      </div>
    </div>

    <!-- Scenario 2 -->
    <div class="section" id="pensionSection" style="display:none;">
      <div class="sectionTitle">Scenario 2: With pension</div>

      <div class="kpi">
        <div class="name">Total earned + invested (cash + pension)</div>
        <div class="val" id="w_totalKpi">£0</div>
      </div>

      <div style="margin-top:12px;">
        <div class="sectionTitle">Income Tax breakdown</div>
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Band</th>
                <th>Income</th>
                <th>Income tax</th>
                <th>Employee NI</th>
                <th>Take-home</th>
                <th>Invested in pension</th>
                <th>Total earned + invested</th>
              </tr>
            </thead>
            <tbody id="w_tableBody"></tbody>
            <tfoot>
              <tr>
                <th>Total</th>
                <th id="w_incomeTotal">£0</th>
                <th id="w_taxTotal">£0</th>
                <th id="w_niTotal">£0</th>
                <th id="w_takeHomeTotal">£0</th>
                <th id="w_pensionTotal">£0</th>
                <th id="w_totalEarnedInvestedTotal">£0</th>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="calcBox">
          <div class="sectionTitle" style="margin:0 0 6px;">Total earned + invested calculation</div>
          <p class="calcEq">Total earned + invested = taxable income − income tax − NI contributions + pension contributions</p>
          <div class="calcNums" id="w_calcNums">£0 = £0 − £0 − £0 + £0</div>
        </div>
      </div>
    </div>
  </div>

<script>
const RULES = {
  personalAllowance: 12570,
  paTaperStart: 100000,
  paZeroAt: 125140,
  taxBandsAfterAllowance: [
    { name: "Basic rate",      from: 0,      to: 37700,    rate: 0.20 },
    { name: "Higher rate",     from: 37700,  to: 125140,   rate: 0.40 },
    { name: "Additional rate", from: 125140, to: Infinity, rate: 0.45 }
  ],
  ni: {
    primaryThresholdWeekly: 242,
    upperEarningsLimitWeekly: 967,
    mainRate: 0.08,
    additionalRate: 0.02
  },
  annualAllowance: {
    standard: 60000,
    thresholdIncomeLimit: 200000,
    adjustedIncomeLimit: 260000,
    minimum: 10000
  }
};

const gbp = n => "£" + Math.round(n).toLocaleString("en-GB");
const clamp = n => (Number.isFinite(n) ? Math.max(0, n) : 0);

function parseMoney(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  const v = el.value;
  if (v === "" || v === null || v === undefined) return 0;
  return clamp(Number(v));
}

// Simplified ANI for this tool: gross - employee pension (salary sacrifice / net pay)
function calcAdjustedNetIncome(grossIncome, employeePension) {
  return Math.max(0, grossIncome - employeePension);
}

// Personal Allowance taper uses ANI
function calcPersonalAllowanceFromANI(ani) {
  if (ani <= RULES.paTaperStart) return RULES.personalAllowance;
  if (ani >= RULES.paZeroAt) return 0;
  const reduction = (ani - RULES.paTaperStart) / 2;
  return Math.max(0, RULES.personalAllowance - reduction);
}

function calcIncomeTax(taxableAfterAllowances) {
  let remaining = Math.max(0, taxableAfterAllowances);
  let tax = 0;
  const breakdown = [];

  for (const b of RULES.taxBandsAfterAllowance) {
    if (remaining <= 0) break;
    const bandWidth = (b.to === Infinity) ? Infinity : (b.to - b.from);
    const amount = Math.min(remaining, bandWidth);
    const bandTax = amount * b.rate;

    breakdown.push({ band: b.name, amount, rate: b.rate, tax: bandTax });
    tax += bandTax;
    remaining -= amount;
  }

  return { tax, breakdown };
}

// Employee NI (Class 1, category A) – approx using weekly thresholds
function calcEmployeeNI_Annual(annualPay) {
  const weekly = Math.max(0, annualPay) / 52;

  const betweenPTandUEL =
    Math.max(0, Math.min(weekly, RULES.ni.upperEarningsLimitWeekly) - RULES.ni.primaryThresholdWeekly);

  const overUEL = Math.max(0, weekly - RULES.ni.upperEarningsLimitWeekly);

  const weeklyNI =
    betweenPTandUEL * RULES.ni.mainRate +
    overUEL * RULES.ni.additionalRate;

  return weeklyNI * 52;
}

// Simplified taper check for this tool:
// threshold income ≈ gross
// adjusted income ≈ gross + employer pension
function calcTaperedAnnualAllowance(grossIncome, employeePension, employerPension) {
  const aa = RULES.annualAllowance;
  const netIncome = Math.max(0, grossIncome - employeePension);
  const thresholdIncome = netIncome + employeePension; // = gross
  const adjustedIncome = netIncome + employeePension + employerPension; // = gross + employer pension

  let allowance = aa.standard;
  const taperApplies = (thresholdIncome > aa.thresholdIncomeLimit) && (adjustedIncome > aa.adjustedIncomeLimit);

  if (taperApplies) {
    const reduction = Math.floor((adjustedIncome - aa.adjustedIncomeLimit) / 2);
    allowance = Math.max(aa.minimum, aa.standard - reduction);
  }

  return { netIncome, thresholdIncome, adjustedIncome, allowance, taperApplies };
}

function showError(msg) {
  const e = document.getElementById("errorBox");
  e.style.display = "block";
  e.innerHTML = "<strong>Error:</strong> " + msg;

  document.getElementById("taperNote").style.display = "none";
  document.getElementById("hero").style.display = "none";
  document.getElementById("baselineSection").style.display = "none";
  document.getElementById("pensionSection").style.display = "none";
}

function clearError() {
  const e = document.getElementById("errorBox");
  e.style.display = "none";
  e.innerHTML = "";
}

function calculateScenario(grossIncome, employeePension, employerPension) {
  const taxableIncome = Math.max(0, grossIncome - employeePension);

  const ani = calcAdjustedNetIncome(grossIncome, employeePension);
  const paAvailable = calcPersonalAllowanceFromANI(ani);
  const personalAllowanceUsed = Math.min(paAvailable, taxableIncome);

  const taxableAfterAllowances = Math.max(0, taxableIncome - personalAllowanceUsed);
  const { tax, breakdown } = calcIncomeTax(taxableAfterAllowances);

  const ni = calcEmployeeNI_Annual(taxableIncome);

  const takeHome = taxableIncome - tax - ni;
  const pensionTotal = employeePension + employerPension;
  const totalEarnedInvested = takeHome + pensionTotal;

  return { taxableIncome, personalAllowanceUsed, tax, breakdown, ni, takeHome, pensionTotal, totalEarnedInvested };
}

function renderScenario1Table(s) {
  const tbody = document.getElementById("b_tableBody");
  tbody.innerHTML = "";

  // Tax-free row (Income Tax only)
  const tr0 = document.createElement("tr");
  tr0.innerHTML = `
    <td>Tax-free (Personal Allowance)</td>
    <td>${gbp(s.personalAllowanceUsed)}</td>
    <td>£0</td>
    <td>—</td>
    <td>—</td>
  `;
  tbody.appendChild(tr0);

  s.breakdown.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.band}</td>
      <td>${gbp(row.amount)}</td>
      <td>${gbp(row.tax)}</td>
      <td>—</td>
      <td>—</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("b_incomeTotal").textContent = gbp(s.taxableIncome);
  document.getElementById("b_taxTotal").textContent = gbp(s.tax);
  document.getElementById("b_niTotal").textContent = gbp(s.ni);
  document.getElementById("b_takeHomeTotal").textContent = gbp(s.takeHome);
}

function renderScenario2Table(s) {
  const tbody = document.getElementById("w_tableBody");
  tbody.innerHTML = "";

  const tr0 = document.createElement("tr");
  tr0.innerHTML = `
    <td>Tax-free (Personal Allowance)</td>
    <td>${gbp(s.personalAllowanceUsed)}</td>
    <td>£0</td>
    <td>—</td>
    <td>—</td>
    <td>—</td>
    <td>—</td>
  `;
  tbody.appendChild(tr0);

  s.breakdown.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.band}</td>
      <td>${gbp(row.amount)}</td>
      <td>${gbp(row.tax)}</td>
      <td>—</td>
      <td>—</td>
      <td>—</td>
      <td>—</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("w_incomeTotal").textContent = gbp(s.taxableIncome);
  document.getElementById("w_taxTotal").textContent = gbp(s.tax);
  document.getElementById("w_niTotal").textContent = gbp(s.ni);
  document.getElementById("w_takeHomeTotal").textContent = gbp(s.takeHome);
  document.getElementById("w_pensionTotal").textContent = gbp(s.pensionTotal);
  document.getElementById("w_totalEarnedInvestedTotal").textContent = gbp(s.totalEarnedInvested);
}

function recalc() {
  const grossIncome = parseMoney("grossIncome");
  const employeePension = parseMoney("employeePension");
  const employerPension = parseMoney("employerPension");

  clearError();

  if (grossIncome <= 0) {
    document.getElementById("taperNote").style.display = "none";
    document.getElementById("hero").style.display = "none";
    document.getElementById("baselineSection").style.display = "none";
    document.getElementById("pensionSection").style.display = "none";
    return;
  }

  if (employeePension > RULES.annualAllowance.standard) {
    showError("Employee pension exceeds £60,000. This tool ignores carry forward. Reduce employee pension to £60,000 or less.");
    return;
  }

  const taper = calcTaperedAnnualAllowance(grossIncome, employeePension, employerPension);
  const totalPensionSavings = employeePension + employerPension;

  const taperBox = document.getElementById("taperNote");
  taperBox.style.display = "block";
  taperBox.innerHTML = `
    <strong>Annual allowance check (tapered allowance):</strong><br/>
    Net income (simplified): ${gbp(taper.netIncome)}<br/>
    Threshold income (simplified): ${gbp(taper.thresholdIncome)}<br/>
    Adjusted income (simplified): ${gbp(taper.adjustedIncome)}<br/>
    Estimated annual allowance: <strong>${gbp(taper.allowance)}</strong>
  `;

  if (totalPensionSavings > taper.allowance) {
    showError(`Total pension savings (employee + employer) are ${gbp(totalPensionSavings)}, which exceeds the estimated annual allowance of ${gbp(taper.allowance)}. This tool does not model the annual allowance charge.`);
    return;
  }

  // Scenario 1 = no pension at all
  const base = calculateScenario(grossIncome, 0, 0);
  const withP = calculateScenario(grossIncome, employeePension, employerPension);

  const delta = withP.totalEarnedInvested - base.totalEarnedInvested;
  document.getElementById("heroDelta").textContent = (delta >= 0 ? "+" : "") + gbp(delta);
  document.getElementById("hero").style.display = "block";

  // Scenario 1
  document.getElementById("b_takeHomeKpi").textContent = gbp(base.takeHome);
  renderScenario1Table(base);
  document.getElementById("b_calcNums").textContent =
    `${gbp(base.totalEarnedInvested)} = ${gbp(base.taxableIncome)} − ${gbp(base.tax)} − ${gbp(base.ni)} + ${gbp(base.pensionTotal)}`;
  document.getElementById("baselineSection").style.display = "block";

  // Scenario 2
  document.getElementById("w_totalKpi").textContent = gbp(withP.totalEarnedInvested);
  renderScenario2Table(withP);
  document.getElementById("w_calcNums").textContent =
    `${gbp(withP.totalEarnedInvested)} = ${gbp(withP.taxableIncome)} − ${gbp(withP.tax)} − ${gbp(withP.ni)} + ${gbp(withP.pensionTotal)}`;
  document.getElementById("pensionSection").style.display = "block";
}

["grossIncome","employeePension","employerPension"].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener("input", recalc);
});
</script>
</body>
</html>
