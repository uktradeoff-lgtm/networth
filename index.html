<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>True Earnings Calculator (UK)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 980px; margin: 28px auto; padding: 0 14px; line-height: 1.35; }
    h1 { font-size: 22px; margin: 0 0 6px; }
    .sub { color:#666; font-size: 13px; margin-bottom: 14px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin: 12px 0; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
    label { display: block; font-weight: 650; margin-bottom: 6px; }
    input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 10px; }
    .hint { color: #555; font-size: 13px; margin-top: 6px; }
    .kpi { background:#fafafa; border:1px solid #eee; border-radius:12px; padding: 12px; }
    .kpi .name { color:#666; font-size: 12px; }
    .kpi .val { font-size: 18px; font-weight: 850; margin-top: 4px; }
    .hero { background:#f6f8ff; border:1px solid #dfe6ff; border-radius: 14px; padding: 14px; margin: 12px 0 10px; }
    .hero .big { font-size: 22px; font-weight: 900; margin-top: 4px; }
    .err { background: #ffecec; border: 1px solid #ffb3b3; padding: 10px; border-radius: 10px; margin-top: 10px; display:none; }
    .warn { background:#fff6e5; border:1px solid #ffd08a; padding:10px; border-radius:10px; margin-top:10px; display:none; }
    table { width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
    th, td { border-bottom:1px solid #eee; padding: 8px; text-align:left; }
    th { background:#fafafa; }
    .sectionTitle { margin: 0 0 6px; font-size: 14px; }
  </style>
</head>
<body>
  <h1>True Earnings Calculator (UK)</h1>
  <div class="sub">
    England, Wales and Northern Ireland rules for 2025/26. Includes Income Tax and employee Class 1 National Insurance (category A).
    Assumes employee pension reduces taxable pay (salary sacrifice or net pay). Carry forward and relief-at-source are not modelled.
    Educational use only.
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px; font-size:16px;">Inputs</h2>

    <div class="grid2">
      <div>
        <label for="grossIncome">Gross income (£/year)</label>
        <input id="grossIncome" type="number" min="0" step="100" placeholder="e.g. 160000" />
        <div class="hint">Annual income before Income Tax and National Insurance.</div>
      </div>
      <div>
        <label for="employeePension">Employee pension contribution (£/year)</label>
        <input id="employeePension" type="number" min="0" step="100" placeholder="e.g. 60000" />
        <div class="hint">This calculator will not run if employee pension exceeds £60,000 (carry forward ignored).</div>
      </div>
    </div>

    <div style="height:10px;"></div>

    <div class="grid2">
      <div>
        <label for="employerPension">Employer pension contribution (£/year, optional)</label>
        <input id="employerPension" type="number" min="0" step="100" placeholder="0" />
        <div class="hint">Included in “true earnings” as additional value generated.</div>
      </div>
      <div></div>
    </div>

    <div id="errorBox" class="err"></div>
    <div id="taperNote" class="warn"></div>
  </div>

  <div class="hero" id="hero" style="display:none;">
    <div class="sectionTitle">Difference in true earnings (with pension vs without)</div>
    <div class="big" id="heroDelta">£0</div>
    <div class="sub" style="margin:6px 0 0;">
      True earnings = take-home pay after Income Tax + employee NI, plus pension contributions (employee + employer).
    </div>
  </div>

  <div class="card" id="baselineCard" style="display:none;">
    <h3 class="sectionTitle">Scenario 1: No employee pension contribution</h3>

    <div class="grid3">
      <div class="kpi">
        <div class="name">Taxable pay</div>
        <div class="val" id="base_taxablePay">£0</div>
      </div>
      <div class="kpi">
        <div class="name">Income tax + employee NI</div>
        <div class="val" id="base_taxPlusNi">£0</div>
      </div>
      <div class="kpi">
        <div class="name">Take-home pay</div>
        <div class="val" id="base_takeHome">£0</div>
      </div>
    </div>

    <h4 class="sectionTitle" style="margin-top:14px;">Breakdown: Income Tax</h4>
    <div class="sub" style="margin:0 0 6px;">
      Personal Allowance (tax-free) is <strong>£12,570</strong>, then the remaining income is taxed in bands below.
      Note: the allowance can be reduced for incomes above £100,000 and can be £0 at £125,140.
    </div>
    <table>
      <thead>
        <tr>
          <th>Band</th>
          <th>Taxed amount</th>
          <th>Rate</th>
          <th>Tax</th>
        </tr>
      </thead>
      <tbody id="base_taxBreakdown"></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th id="base_taxedTotal">£0</th>
          <th></th>
          <th id="base_taxTotal">£0</th>
        </tr>
      </tfoot>
    </table>

    <h4 class="sectionTitle" style="margin-top:14px;">Breakdown: Employee NI (Class 1, category A)</h4>
    <table>
      <thead>
        <tr>
          <th>Band</th>
          <th>NI-able pay</th>
          <th>Rate</th>
          <th>NI</th>
        </tr>
      </thead>
      <tbody id="base_niBreakdown"></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th></th>
          <th></th>
          <th id="base_niTotal">£0</th>
        </tr>
      </tfoot>
    </table>

    <div class="sub" style="margin-top:10px;">
      NI uses weekly thresholds and is approximated here by spreading annual pay evenly across 52 weeks.
    </div>
  </div>

  <div class="card" id="pensionCard" style="display:none;">
    <h3 class="sectionTitle">Scenario 2: With pension contributions</h3>

    <div class="grid3">
      <div class="kpi">
        <div class="name">Taxable pay after pension</div>
        <div class="val" id="with_taxablePay">£0</div>
      </div>
      <div class="kpi">
        <div class="name">Income tax + employee NI</div>
        <div class="val" id="with_taxPlusNi">£0</div>
      </div>
      <div class="kpi">
        <div class="name">Take-home pay</div>
        <div class="val" id="with_takeHome">£0</div>
      </div>
    </div>

    <div class="grid3">
      <div class="kpi">
        <div class="name">Total pension contribution (employee + employer)</div>
        <div class="val" id="with_pensionTotal">£0</div>
      </div>
      <div class="kpi">
        <div class="name">True earnings (take-home + pension)</div>
        <div class="val" id="with_trueEarnings">£0</div>
      </div>
      <div class="kpi">
        <div class="name"></div>
        <div class="val"></div>
      </div>
    </div>

    <h4 class="sectionTitle" style="margin-top:14px;">Breakdown: Income Tax</h4>
    <div class="sub" style="margin:0 0 6px;">
      Personal Allowance (tax-free) is <strong>£12,570</strong>, then the remaining income is taxed in bands below.
      Note: the allowance can be reduced for incomes above £100,000 and can be £0 at £125,140.
    </div>
    <table>
      <thead>
        <tr>
          <th>Band</th>
          <th>Taxed amount</th>
          <th>Rate</th>
          <th>Tax</th>
        </tr>
      </thead>
      <tbody id="with_taxBreakdown"></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th id="with_taxedTotal">£0</th>
          <th></th>
          <th id="with_taxTotal">£0</th>
        </tr>
      </tfoot>
    </table>

    <h4 class="sectionTitle" style="margin-top:14px;">Breakdown: Employee NI (Class 1, category A)</h4>
    <table>
      <thead>
        <tr>
          <th>Band</th>
          <th>NI-able pay</th>
          <th>Rate</th>
          <th>NI</th>
        </tr>
      </thead>
      <tbody id="with_niBreakdown"></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th></th>
          <th></th>
          <th id="with_niTotal">£0</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <script>
    const RULES_2025_26 = {
      personalAllowance: 12570,
      paTaperStart: 100000,
      paZeroAt: 125140,
      bandsAfterAllowances: [
        { name: "Basic rate",    from: 0,       to: 37700,    rate: 0.20 },
        { name: "Higher rate",   from: 37700,   to: 125140,   rate: 0.40 },
        { name: "Additional",    from: 125140, to: Infinity, rate: 0.45 }
      ],
      ni: {
        primaryThresholdWeekly: 242,
        upperEarningsLimitWeekly: 967,
        mainRate: 0.08,
        addlRate: 0.02
      },
      annualAllowance: {
        standard: 60000,
        thresholdLimit: 200000,
        adjustedLimit: 260000,
        min: 10000
      }
    };

    function gbp(n) {
      const x = Math.round(n);
      return "£" + x.toLocaleString("en-GB");
    }
    function clamp(n) {
      return Number.isFinite(n) ? Math.max(0, n) : 0;
    }
    function parseMoney(id) {
      const v = document.getElementById(id).value;
      if (v === "" || v === null || v === undefined) return 0;
      return clamp(Number(v));
    }

    function calcPersonalAllowance(grossIncome, rules) {
      const pa = rules.personalAllowance;
      if (grossIncome <= rules.paTaperStart) return pa;
      if (grossIncome >= rules.paZeroAt) return 0;
      const reduction = (grossIncome - rules.paTaperStart) / 2;
      return Math.max(0, pa - reduction);
    }

    function calcIncomeTax(taxableAfterAllowances, rules) {
      let remaining = clamp(taxableAfterAllowances);
      let tax = 0;
      const breakdown = [];
      for (const band of rules.bandsAfterAllowances) {
        if (remaining <= 0) break;
        const bandWidth = (band.to === Infinity) ? Infinity : (band.to - band.from);
        const taxedAmount = Math.min(remaining, bandWidth);
        const bandTax = taxedAmount * band.rate;
        tax += bandTax;
        breakdown.push({ band: band.name, amount: taxedAmount, rate: band.rate, tax: bandTax });
        remaining -= taxedAmount;
      }
      return { tax, breakdown };
    }

    function calcEmployeeNI_Annual(payAnnualForNI, rules) {
      const ni = rules.ni;
      const weekly = Math.max(0, payAnnualForNI) / 52;

      const mainBandWeekly = Math.max(0, Math.min(weekly, ni.upperEarningsLimitWeekly) - ni.primaryThresholdWeekly);
      const addlBandWeekly = Math.max(0, weekly - ni.upperEarningsLimitWeekly);

      const weeklyNI = (mainBandWeekly * ni.mainRate) + (addlBandWeekly * ni.addlRate);

      return {
        annual: weeklyNI * 52,
        mainBandAnnual: mainBandWeekly * 52,
        addlBandAnnual: addlBandWeekly * 52,
        mainRate: ni.mainRate,
        addlRate: ni.addlRate
      };
    }

    function calcTaperedAnnualAllowance(grossIncome, employeePension, employerPension, rules) {
      const aa = rules.annualAllowance;

      const netIncome = grossIncome;
      const thresholdIncome = netIncome + employeePension;
      const adjustedIncome = netIncome + employeePension + employerPension;

      let allowance = aa.standard;

      const taperApplies = (thresholdIncome > aa.thresholdLimit) && (adjustedIncome > aa.adjustedLimit);
      if (taperApplies) {
        const reduction = Math.floor((adjustedIncome - aa.adjustedLimit) / 2);
        allowance = Math.max(aa.min, aa.standard - reduction);
      }
      return { thresholdIncome, adjustedIncome, allowance };
    }

    function renderTaxBreakdown(tbodyId, totalTaxedId, totalTaxId, breakdown, totalTax) {
      const tbody = document.getElementById(tbodyId);
      tbody.innerHTML = "";
      let totalTaxed = 0;
      breakdown.forEach(row => {
        totalTaxed += row.amount;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.band}</td>
          <td>${gbp(row.amount)}</td>
          <td>${Math.round(row.rate * 100)}%</td>
          <td>${gbp(row.tax)}</td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById(totalTaxedId).textContent = gbp(totalTaxed);
      document.getElementById(totalTaxId).textContent = gbp(totalTax);
    }

    function renderNiBreakdown(tbodyId, totalId, niDetails) {
      const tbody = document.getElementById(tbodyId);
      tbody.innerHTML = "";

      const annualMain = niDetails.mainBandAnnual * niDetails.mainRate;
      const annualAddl = niDetails.addlBandAnnual * niDetails.addlRate;

      const rows = [
        { band: "Between Primary Threshold and Upper Earnings Limit", amountAnnual: niDetails.mainBandAnnual, rate: niDetails.mainRate, niAnnual: annualMain },
        { band: "Over Upper Earnings Limit", amountAnnual: niDetails.addlBandAnnual, rate: niDetails.addlRate, niAnnual: annualAddl }
      ];

      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.band}</td>
          <td>${gbp(r.amountAnnual)}</td>
          <td>${Math.round(r.rate * 100)}%</td>
          <td>${gbp(r.niAnnual)}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById(totalId).textContent = gbp(niDetails.annual);
    }

    function showError(msg) {
      const e = document.getElementById("errorBox");
      e.style.display = "block";
      e.innerHTML = "<strong>Error:</strong> " + msg;
      document.getElementById("taperNote").style.display = "none";
      document.getElementById("hero").style.display = "none";
      document.getElementById("baselineCard").style.display = "none";
      document.getElementById("pensionCard").style.display = "none";
    }

    function clearError() {
      const e = document.getElementById("errorBox");
      e.style.display = "none";
      e.innerHTML = "";
    }

    function calculateScenario(grossIncome, employeePension, employerPension, rules) {
      const taxablePay = Math.max(0, grossIncome - employeePension);

      const personalAllowance = calcPersonalAllowance(grossIncome, rules);
      const taxableAfterAllowances = Math.max(0, taxablePay - personalAllowance);
      const { tax, breakdown } = calcIncomeTax(taxableAfterAllowances, rules);

      const ni = calcEmployeeNI_Annual(taxablePay, rules);

      const takeHome = taxablePay - tax - ni.annual;
      const pensionTotal = employeePension + employerPension;
      const trueEarnings = takeHome + pensionTotal;

      return { taxablePay, personalAllowance, tax, breakdown, ni, takeHome, pensionTotal, trueEarnings };
    }

    function recalc() {
      const rules = RULES_2025_26;

      const grossIncome = parseMoney("grossIncome");
      const employeePension = parseMoney("employeePension");
      const employerPension = parseMoney("employerPension");

      clearError();

      if (grossIncome <= 0) {
        document.getElementById("taperNote").style.display = "none";
        document.getElementById("hero").style.display = "none";
        document.getElementById("baselineCard").style.display = "none";
        document.getElementById("pensionCard").style.display = "none";
        return;
      }

      if (employeePension > rules.annualAllowance.standard) {
        showError("Employee pension contribution exceeds £60,000. This tool ignores carry forward. Reduce pension to £60,000 or less.");
        return;
      }

      // Taper check
      const taper = calcTaperedAnnualAllowance(grossIncome, employeePension, employerPension, rules);
      const totalPensionSavings = employeePension + employerPension;

      const taperBox = document.getElementById("taperNote");
      taperBox.innerHTML =
        `<strong>Annual allowance check (tapered allowance):</strong><br/>
         Threshold income: ${gbp(taper.thresholdIncome)} · Adjusted income: ${gbp(taper.adjustedIncome)}<br/>
         Estimated annual allowance: <strong>${gbp(taper.allowance)}</strong>`;
      taperBox.style.display = "block";

      if (totalPensionSavings > taper.allowance) {
        showError(`Total pension savings (employee + employer) are ${gbp(totalPensionSavings)}, which exceeds the estimated annual allowance of ${gbp(taper.allowance)}. This tool does not model the annual allowance charge.`);
        return;
      }

      const base = calculateScenario(grossIncome, 0, employerPension, rules);
      const withP = calculateScenario(grossIncome, employeePension, employerPension, rules);

      const delta = withP.trueEarnings - base.trueEarnings;

      document.getElementById("heroDelta").textContent = (delta >= 0 ? "+" : "") + gbp(delta);
      document.getElementById("hero").style.display = "block";

      // Scenario 1
      document.getElementById("base_taxablePay").textContent = gbp(base.taxablePay);
      document.getElementById("base_taxPlusNi").textContent = gbp(base.tax + base.ni.annual);
      document.getElementById("base_takeHome").textContent = gbp(base.takeHome);

      renderTaxBreakdown("base_taxBreakdown", "base_taxedTotal", "base_taxTotal", base.breakdown, base.tax);
      renderNiBreakdown("base_niBreakdown", "base_niTotal", base.ni);

      document.getElementById("baselineCard").style.display = "block";

      // Scenario 2
      document.getElementById("with_taxablePay").textContent = gbp(withP.taxablePay);
      document.getElementById("with_taxPlusNi").textContent = gbp(withP.tax + withP.ni.annual);
      document.getElementById("with_takeHome").textContent = gbp(withP.takeHome);

      document.getElementById("with_pensionTotal").textContent = gbp(withP.pensionTotal);
      document.getElementById("with_trueEarnings").textContent = gbp(withP.trueEarnings);

      renderTaxBreakdown("with_taxBreakdown", "with_taxedTotal", "with_taxTotal", withP.breakdown, withP.tax);
      renderNiBreakdown("with_niBreakdown", "with_niTotal", withP.ni);

      document.getElementById("pensionCard").style.display = "block";
    }

    ["grossIncome", "employeePension", "employerPension"].forEach(id => {
      document.getElementById(id).addEventListener("input", recalc);
    });
  </script>
</body>
</html>
