<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>True Earnings Calculator (UK)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 980px; margin: 28px auto; padding: 0 14px; line-height: 1.35; }
    h1 { font-size: 22px; margin: 0 0 6px; }
    .sub { color:#666; font-size: 13px; margin-bottom: 14px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin: 12px 0; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
    label { display: block; font-weight: 650; margin-bottom: 6px; }
    input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 10px; }
    .hint { color: #555; font-size: 13px; margin-top: 6px; }
    .kpi { background:#fafafa; border:1px solid #eee; border-radius:12px; padding: 12px; }
    .kpi .name { color:#666; font-size: 12px; }
    .kpi .val { font-size: 18px; font-weight: 850; margin-top: 4px; }
    .hero { background:#f6f8ff; border:1px solid #dfe6ff; border-radius: 14px; padding: 14px; margin: 12px 0 10px; }
    .hero .big { font-size: 22px; font-weight: 900; margin-top: 4px; }
    .err { background: #ffecec; border: 1px solid #ffb3b3; padding: 10px; border-radius: 10px; margin-top: 10px; display:none; }
    .warn { background:#fff6e5; border:1px solid #ffd08a; padding:10px; border-radius:10px; margin-top:10px; display:none; }
    table { width:100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
    th, td { border-bottom:1px solid #eee; padding: 8px; text-align:left; }
    th { background:#fafafa; }
    .sectionTitle { margin: 0 0 6px; font-size: 14px; }
  </style>
</head>
<body>

<h1>True Earnings Calculator (UK)</h1>
<div class="sub">
  England, Wales and Northern Ireland rules for 2025/26.  
  Includes Income Tax and employee Class 1 National Insurance (category A).  
  Assumes employee pension reduces adjusted net income (salary sacrifice / net pay).  
  Carry forward and relief-at-source are not modelled. Educational use only.
</div>

<div class="card">
  <h2 style="margin:0 0 10px; font-size:16px;">Inputs</h2>

  <div class="grid2">
    <div>
      <label>Gross income (£/year)</label>
      <input id="grossIncome" type="number" step="100" placeholder="e.g. 160000">
    </div>
    <div>
      <label>Employee pension (£/year)</label>
      <input id="employeePension" type="number" step="100" placeholder="e.g. 60000">
      <div class="hint">Hard cap £60,000 (carry forward ignored).</div>
    </div>
  </div>

  <div style="height:10px;"></div>

  <div class="grid2">
    <div>
      <label>Employer pension (£/year, optional)</label>
      <input id="employerPension" type="number" step="100" placeholder="0">
    </div>
    <div></div>
  </div>

  <div id="errorBox" class="err"></div>
  <div id="taperNote" class="warn"></div>
</div>

<div class="hero" id="hero" style="display:none;">
  <div class="sectionTitle">Difference in true earnings (with pension vs without)</div>
  <div class="big" id="heroDelta">£0</div>
</div>

<div class="card" id="baselineCard" style="display:none;">
  <h3 class="sectionTitle">Scenario 1: No employee pension</h3>

  <div class="grid3">
    <div class="kpi"><div class="name">Taxable pay</div><div class="val" id="b_taxable">£0</div></div>
    <div class="kpi"><div class="name">Income tax + NI</div><div class="val" id="b_taxni">£0</div></div>
    <div class="kpi"><div class="name">Take-home pay</div><div class="val" id="b_takehome">£0</div></div>
  </div>

  <h4 class="sectionTitle" style="margin-top:14px;">Income Tax breakdown</h4>
  <table>
    <thead><tr><th>Band</th><th>Amount</th><th>Rate</th><th>Tax</th></tr></thead>
    <tbody id="b_taxTable"></tbody>
    <tfoot><tr><th>Total</th><th id="b_taxedTotal">£0</th><th></th><th id="b_taxTotal">£0</th></tr></tfoot>
  </table>

  <h4 class="sectionTitle" style="margin-top:14px;">Employee NI breakdown</h4>
  <table>
    <thead><tr><th>Band</th><th>NI-able pay</th><th>Rate</th><th>NI</th></tr></thead>
    <tbody id="b_niTable"></tbody>
    <tfoot><tr><th>Total</th><th></th><th></th><th id="b_niTotal">£0</th></tr></tfoot>
  </table>
</div>

<div class="card" id="pensionCard" style="display:none;">
  <h3 class="sectionTitle">Scenario 2: With pension</h3>

  <div class="grid3">
    <div class="kpi"><div class="name">Taxable pay</div><div class="val" id="w_taxable">£0</div></div>
    <div class="kpi"><div class="name">Income tax + NI</div><div class="val" id="w_taxni">£0</div></div>
    <div class="kpi"><div class="name">Take-home pay</div><div class="val" id="w_takehome">£0</div></div>
  </div>

  <div class="grid3">
    <div class="kpi"><div class="name">Total pension</div><div class="val" id="w_pension">£0</div></div>
    <div class="kpi"><div class="name">True earnings</div><div class="val" id="w_true">£0</div></div>
    <div></div>
  </div>

  <h4 class="sectionTitle" style="margin-top:14px;">Income Tax breakdown</h4>
  <table>
    <thead><tr><th>Band</th><th>Amount</th><th>Rate</th><th>Tax</th></tr></thead>
    <tbody id="w_taxTable"></tbody>
    <tfoot><tr><th>Total</th><th id="w_taxedTotal">£0</th><th></th><th id="w_taxTotal">£0</th></tr></tfoot>
  </table>

  <h4 class="sectionTitle" style="margin-top:14px;">Employee NI breakdown</h4>
  <table>
    <thead><tr><th>Band</th><th>NI-able pay</th><th>Rate</th><th>NI</th></tr></thead>
    <tbody id="w_niTable"></tbody>
    <tfoot><tr><th>Total</th><th></th><th></th><th id="w_niTotal">£0</th></tr></tfoot>
  </table>
</div>

<script>
const RULES = {
  pa: 12570,
  taperStart: 100000,
  taperEnd: 125140,
  taxBands: [
    { name:"Basic rate", limit:37700, rate:0.20 },
    { name:"Higher rate", limit:125140, rate:0.40 },
    { name:"Additional rate", limit:Infinity, rate:0.45 }
  ],
  ni: {
    pt: 242, uel: 967, main:0.08, add:0.02
  },
  annualAllowance: { standard:60000, threshold:200000, adjusted:260000, min:10000 }
};

const gbp = n => "£" + Math.round(n).toLocaleString("en-GB");

function adjustedNetIncome(gross, empPen) {
  return Math.max(0, gross - empPen);
}

function personalAllowance(ani) {
  if (ani <= RULES.taperStart) return RULES.pa;
  if (ani >= RULES.taperEnd) return 0;
  return Math.max(0, RULES.pa - (ani - RULES.taperStart) / 2);
}

function incomeTax(taxable) {
  let remaining = taxable, tax = 0, rows = [];
  for (const b of RULES.taxBands) {
    if (remaining <= 0) break;
    const slice = Math.min(remaining, b.limit);
    const t = slice * b.rate;
    rows.push({ name:b.name, amt:slice, rate:b.rate, tax:t });
    tax += t;
    remaining -= slice;
  }
  return { tax, rows };
}

function niAnnual(pay) {
  const w = pay / 52;
  const main = Math.max(0, Math.min(w, RULES.ni.uel) - RULES.ni.pt);
  const add = Math.max(0, w - RULES.ni.uel);
  return {
    total: (main*RULES.ni.main + add*RULES.ni.add)*52,
    rows: [
      { name:"Between Primary Threshold and Upper Earnings Limit", amt:main*52, rate:RULES.ni.main },
      { name:"Over Upper Earnings Limit", amt:add*52, rate:RULES.ni.add }
    ]
  };
}

function scenario(gross, empPen, erPen) {
  const taxable = gross - empPen;
  const ani = adjustedNetIncome(gross, empPen);
  const paAvail = personalAllowance(ani);
  const paUsed = Math.min(paAvail, taxable);
  const { tax, rows } = incomeTax(taxable - paUsed);
  const ni = niAnnual(taxable);
  const takeHome = taxable - tax - ni.total;
  return {
    taxable, paUsed, tax, taxRows:rows, ni, takeHome,
    pension: empPen + erPen,
    trueEarnings: takeHome + empPen + erPen
  };
}

function renderTax(id, paUsed, rows, tax) {
  const tb = document.getElementById(id);
  tb.innerHTML = `<tr><td><strong>Tax-free (Personal Allowance)</strong></td><td>${gbp(paUsed)}</td><td>0%</td><td>£0</td></tr>`;
  let tot = paUsed;
  rows.forEach(r=>{
    tb.innerHTML += `<tr><td>${r.name}</td><td>${gbp(r.amt)}</td><td>${r.rate*100}%</td><td>${gbp(r.tax)}</td></tr>`;
    tot += r.amt;
  });
  return tot;
}

function renderNI(id, ni) {
  const tb = document.getElementById(id);
  tb.innerHTML = "";
  ni.rows.forEach(r=>{
    tb.innerHTML += `<tr><td>${r.name}</td><td>${gbp(r.amt)}</td><td>${r.rate*100}%</td><td>${gbp(r.amt*r.rate)}</td></tr>`;
  });
}

function recalc() {
  const g = +grossIncome.value||0;
  const ep = +employeePension.value||0;
  const er = +employerPension.value||0;
  if (!g) return;

  if (ep > RULES.annualAllowance.standard) {
    errorBox.style.display="block";
    errorBox.textContent="Employee pension exceeds £60,000. Carry forward ignored.";
    return;
  }
  errorBox.style.display="none";

  const b = scenario(g,0,er);
  const w = scenario(g,ep,er);

  hero.style.display="block";
  heroDelta.textContent = gbp(w.trueEarnings - b.trueEarnings);

  baselineCard.style.display="block";
  b_taxable.textContent = gbp(b.taxable);
  b_taxni.textContent = gbp(b.tax + b.ni.total);
  b_takehome.textContent = gbp(b.takeHome);
  const bt = renderTax("b_taxTable", b.paUsed, b.taxRows, b.tax);
  b_taxedTotal.textContent = gbp(bt);
  b_taxTotal.textContent = gbp(b.tax);
  renderNI("b_niTable", b.ni);
  b_niTotal.textContent = gbp(b.ni.total);

  pensionCard.style.display="block";
  w_taxable.textContent = gbp(w.taxable);
  w_taxni.textContent = gbp(w.tax + w.ni.total);
  w_takehome.textContent = gbp(w.takeHome);
  w_pension.textContent = gbp(w.pension);
  w_true.textContent = gbp(w.trueEarnings);
  const wt = renderTax("w_taxTable", w.paUsed, w.taxRows, w.tax);
  w_taxedTotal.textContent = gbp(wt);
  w_taxTotal.textContent = gbp(w.tax);
  renderNI("w_niTable", w.ni);
  w_niTotal.textContent = gbp(w.ni.total);
}

["grossIncome","employeePension","employerPension"].forEach(id=>{
  document.getElementById(id).addEventListener("input",recalc);
});
</script>
</body>
</html>
